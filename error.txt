
when clicking the likes number i need to add it so it shows previously liked comments
that i'm sure i'll figure out

but the allowing two people to like one comment and not break it...
i feel like that is more so in the scope of js/ajax no?

currently the issue seems to be that if user #1 likes user #3's message
that when user #2 tries to like user #3's message it breaks and won't allow it

bewlow is what the terminal says and then what the
debuggertool says

let me know if thats something i should just look past for now or if you have any
ideas on how to go about implimenting that








** this is using #2 liking a message from user #1


127.0.0.1 - - [02/Jun/2023 23:53:16] "POST /users/add_like/1008 HTTP/1.1" 302 -
127.0.0.1 - - [02/Jun/2023 23:53:16] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:53:16] "GET /static/stylesheets/style.css HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /_debug_toolbar/static/js/jquery.js HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /_debug_toolbar/static/js/jquery.tablesorter.js HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /static/images/default-pic.png HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /_debug_toolbar/static/js/toolbar.js HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /static/images/warbler-logo.png HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /static/images/warbler-hero.jpg HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /_debug_toolbar/static/css/toolbar.css?0.6374028626448027 HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:53:17] "GET /_debug_toolbar/static/img/djdt_vertical.png HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:18] "POST /users/add_like/1009 HTTP/1.1" 302 -
127.0.0.1 - - [02/Jun/2023 23:53:18] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:53:18] "GET /static/stylesheets/style.css HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:53:18] "GET /_debug_toolbar/static/js/jquery.js HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:18] "GET /_debug_toolbar/static/js/jquery.tablesorter.js HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:19] "GET /static/images/warbler-logo.png HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:19] "GET /_debug_toolbar/static/js/toolbar.js HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:19] "GET /static/images/default-pic.png HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:19] "GET /static/images/warbler-hero.jpg HTTP/1.1" 304 -
127.0.0.1 - - [02/Jun/2023 23:53:19] "GET /_debug_toolbar/static/css/toolbar.css?0.9428467190663052 HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:53:19] "GET /_debug_toolbar/static/img/djdt_vertical.png HTTP/1.1" 304 -










** this is user #2 liking the same message from a third user that 
** this is the terminal 


127.0.0.1 - - [02/Jun/2023 23:55:25] "POST /users/add_like/948 HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 2295, in wsgi_app
    response = self.handle_exception(e)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1741, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/_compat.py", line 35, in reraise
    raise value
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1718, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/_compat.py", line 35, in reraise
    raise value
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask_debugtoolbar/__init__.py", line 125, in dispatch_request
    return view_func(**req.view_args)
  File "/Users/windie/Documents/Springboard/SEC/warbler/app.py", line 274, in add_like
    db.session.commit()
  File "<string>", line 2, in commit
    
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 1428, in commit
    self._transaction.commit(_to_root=self.future)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 829, in commit
    self._prepare_impl()
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
    self.session.flush()
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 3339, in flush
    self._flush(objects)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 3479, in _flush
    transaction.rollback(_capture_exception=True)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/util/langhelpers.py", line 72, in __exit__
    with_traceback=exc_tb,
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 3439, in _flush
    flush_context.execute()
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
    rec.execute(self)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/unitofwork.py", line 579, in execute
    self.dependency_processor.process_saves(uow, states)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/dependency.py", line 1183, in process_saves
    uowcommit, secondary_insert, secondary_update, secondary_delete
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/dependency.py", line 1245, in _run_crud
    connection.execute(statement, secondary_insert)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1286, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/sql/elements.py", line 324, in _execute_on_connection
    self, multiparams, params, execution_options
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1488, in _execute_clauseelement
    cache_hit=cache_hit,
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    e, statement, parameters, cursor, context
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2024, in _handle_dbapi_exception
    sqlalchemy_exception, with_traceback=exc_info[2], from_=e
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1800, in _execute_context
    cursor, statement, parameters, context
  File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "likes_message_id_key"
DETAIL:  Key (message_id)=(948) already exists.

[SQL: INSERT INTO likes (user_id, message_id, likes_count, liked_count) VALUES (%(user_id)s, %(message_id)s, %(likes_count)s, %(liked_count)s) RETURNING likes.id]
[parameters: {'user_id': 302, 'message_id': 948, 'likes_count': 0, 'liked_count': 0}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
127.0.0.1 - - [02/Jun/2023 23:55:25] "GET /users/add_like/948?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:55:25] "GET /users/add_like/948?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:55:25] "GET /users/add_like/948?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:55:25] "GET /users/add_like/948?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
127.0.0.1 - - [02/Jun/2023 23:55:25] "GET /users/add_like/948?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1" 200 -










** this what the debugger gives me


sqlalchemy.exc.IntegrityError
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "likes_message_id_key"
DETAIL:  Key (message_id)=(948) already exists.

[SQL: INSERT INTO likes (user_id, message_id, likes_count, liked_count) VALUES (%(user_id)s, %(message_id)s, %(likes_count)s, %(liked_count)s) RETURNING likes.id]
[parameters: {'user_id': 302, 'message_id': 948, 'likes_count': 0, 'liked_count': 0}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

Traceback (most recent call last)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 2309, in __call__
return self.wsgi_app(environ, start_response)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 2295, in wsgi_app
response = self.handle_exception(e)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1741, in handle_exception
reraise(exc_type, exc_value, tb)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/_compat.py", line 35, in reraise
raise value
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 2292, in wsgi_app
response = self.full_dispatch_request()
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1815, in full_dispatch_request
rv = self.handle_user_exception(e)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1718, in handle_user_exception
reraise(exc_type, exc_value, tb)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/_compat.py", line 35, in reraise
raise value
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask/app.py", line 1813, in full_dispatch_request
rv = self.dispatch_request()
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/flask_debugtoolbar/__init__.py", line 125, in dispatch_request
return view_func(**req.view_args)
File "/Users/windie/Documents/Springboard/SEC/warbler/app.py", line 274, in add_like
db.session.commit()
File "<string>", line 2, in commit
 
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 1428, in commit
self._transaction.commit(_to_root=self.future)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 829, in commit
self._prepare_impl()
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 808, in _prepare_impl
self.session.flush()
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 3339, in flush
self._flush(objects)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 3479, in _flush
transaction.rollback(_capture_exception=True)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/util/langhelpers.py", line 72, in __exit__
with_traceback=exc_tb,
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
raise exception
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/session.py", line 3439, in _flush
flush_context.execute()
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/unitofwork.py", line 456, in execute
rec.execute(self)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/unitofwork.py", line 579, in execute
self.dependency_processor.process_saves(uow, states)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/dependency.py", line 1183, in process_saves
uowcommit, secondary_insert, secondary_update, secondary_delete
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/orm/dependency.py", line 1245, in _run_crud
connection.execute(statement, secondary_insert)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1286, in execute
return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/sql/elements.py", line 324, in _execute_on_connection
self, multiparams, params, execution_options
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1488, in _execute_clauseelement
cache_hit=cache_hit,
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
e, statement, parameters, cursor, context
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2024, in _handle_dbapi_exception
sqlalchemy_exception, with_traceback=exc_info[2], from_=e
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
raise exception
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1800, in _execute_context
cursor, statement, parameters, context
File "/Users/windie/Documents/Springboard/SEC/warbler/venv/lib/python3.7/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "likes_message_id_key" DETAIL: Key (message_id)=(948) already exists. [SQL: INSERT INTO likes (user_id, message_id, likes_count, liked_count) VALUES (%(user_id)s, %(message_id)s, %(likes_count)s, %(liked_count)s) RETURNING likes.id] [parameters: {'user_id': 302, 'message_id': 948, 'likes_count': 0, 'liked_count': 0}] (Background on this error at: https://sqlalche.me/e/14/gkpj)

*** *** *** *** ***
